/***************************************************************************//**
 * @file
 * @brief Top level application functions
 *******************************************************************************
 * # License
 * <b>Copyright 2020 Silicon Laboratories Inc. www.silabs.com</b>
 *******************************************************************************
 *
 * The licensor of this software is Silicon Laboratories Inc. Your use of this
 * software is governed by the terms of Silicon Labs Master Software License
 * Agreement (MSLA) available at
 * www.silabs.com/about-us/legal/master-software-license-agreement. This
 * software is distributed to you in Source Code format and is governed by the
 * sections of the MSLA applicable to Source Code.
 *
 ******************************************************************************/

/***************************************************************************//**
 * Initialize application.
 ******************************************************************************/
#include <string.h>
#include "sl_spidrv_instances.h"
#include "mikroe_e_paper_154_inch_config.h"
#include "glib.h"
#include "mikroe_e_paper_154_inch.h"

const char *str1 = "SILICON LABS";
const char *str2 = "APPLICATION EXAMPLES";
static glib_context_t g_context;

const uint8_t EINK154_LUT_TABLE[30] =
{
  0x02, 0x02, 0x01, 0x11, 0x12, 0x12, 0x22, 0x22,
  0x66, 0x69, 0x69, 0x59, 0x58, 0x99, 0x99, 0x88,
  0x00, 0x00, 0x00, 0x00, 0xF8, 0xB4, 0x13, 0x51,
  0x35, 0x51, 0x51, 0x19, 0x01, 0x00
};

static const unsigned char silicon_labs_logo_96x35[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0x00, 0x00, 0xe0, 0x03,
  0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xff, 0xff, 0x0f, 0x00, 0xc0, 0x07,
  0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xff, 0xff, 0x3f, 0x00, 0xc0, 0x1f,
  0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x7f, 0x00, 0xe0, 0x3f,
  0x00, 0x00, 0x00, 0x00, 0xc0, 0xff, 0xff, 0xff, 0x7f, 0x00, 0xf0, 0x7f,
  0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0xff, 0xff, 0x3f, 0x00, 0xf8, 0x7f,
  0x00, 0x80, 0x01, 0x00, 0xf8, 0xff, 0xff, 0xff, 0x1f, 0x00, 0xfe, 0x7f,
  0x00, 0xe0, 0x00, 0x00, 0xfc, 0xff, 0xff, 0xff, 0xff, 0x00, 0xff, 0xff,
  0x00, 0x78, 0x00, 0x00, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xcf, 0xff, 0xff,
  0x00, 0x3c, 0x00, 0x00, 0xfe, 0x7f, 0x00, 0x00, 0xf8, 0xff, 0xff, 0x7f,
  0x00, 0x3f, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x7f,
  0x80, 0x3f, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0x3f,
  0xe0, 0x3f, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xff, 0x3f,
  0xf0, 0x3f, 0x00, 0x00, 0x80, 0xff, 0x1f, 0x00, 0x00, 0x80, 0xff, 0x1f,
  0xf8, 0x7f, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x01, 0x00, 0x80, 0xff, 0x0f,
  0xfc, 0xff, 0x01, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0xff, 0x07,
  0xfc, 0xff, 0x07, 0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x00, 0xff, 0x01,
  0xfe, 0xff, 0x3f, 0x00, 0x00, 0x00, 0xc0, 0x0f, 0x00, 0x00, 0xff, 0x00,
  0xfe, 0xff, 0xff, 0x1f, 0x00, 0xc0, 0xff, 0x0f, 0x00, 0x80, 0x3f, 0x00,
  0xfe, 0xff, 0xf8, 0xff, 0xff, 0xff, 0xff, 0x0f, 0x00, 0xc0, 0x0f, 0x00,
  0xfe, 0x0f, 0x00, 0xfe, 0xff, 0xff, 0xff, 0x07, 0x00, 0xe0, 0x03, 0x00,
  0xfe, 0x03, 0x00, 0xfe, 0xff, 0xff, 0xff, 0x03, 0x00, 0xf0, 0x00, 0x00,
  0xfe, 0x01, 0x80, 0xff, 0xff, 0xff, 0xff, 0x01, 0x00, 0x38, 0x00, 0x00,
  0xfc, 0x00, 0x80, 0xff, 0xff, 0xff, 0x7f, 0x00, 0x00, 0x0e, 0x00, 0x00,
  0xfc, 0x00, 0x80, 0xff, 0xff, 0xff, 0x1f, 0x00, 0x80, 0x01, 0x00, 0x00,
  0xf0, 0x00, 0x80, 0xff, 0xff, 0xff, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00,
  0xe0, 0x00, 0x00, 0xfe, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x80, 0x00, 0x00, 0xe0, 0xff, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

void app_init(void)
{
  glib_init(&g_context);
  g_context.wrap = false;
  g_context.text_color = E_PAPER_SCREEN_COLOR_BLACK;

  mikroe_e_paper_154_inch_init(sl_spidrv_mikroe_handle);
  mikroe_e_paper_154_inch_start_config();
  mikroe_e_paper_154_inch_set_lut(EINK154_LUT_TABLE, 30);

  glib_fill(&g_context, E_PAPER_SCREEN_COLOR_WHITE);
  glib_draw_xbitmap(&g_context,
                    52, 82, silicon_labs_logo_96x35,
                    96, 35, EINK154_SCREEN_COLOR_BLACK);
  glib_draw_string(&g_context, str1,
                   (MIKROE_E_PAPER_WIDTH - strlen(str1) * 6 + 1) / 2, 140);
  glib_draw_string(&g_context, str2,
                   (MIKROE_E_PAPER_WIDTH - strlen(str2) * 6 + 1) / 2, 160);
  glib_update_display();
}

/***************************************************************************//**
 * App ticking function.
 ******************************************************************************/
void app_process_action(void)
{
}
